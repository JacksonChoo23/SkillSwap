<%- include('../partials/header') %>
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-5">
      <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white text-center py-4">
          <h2 class="h3 mb-0">
            <i class="fas fa-sign-in-alt me-2"></i>
            Welcome Back
          </h2>
          <p class="mb-0 opacity-75">Sign in to your SkillSwap MY account</p>
        </div>
        <div class="card-body p-4">
          <form method="POST" action="/auth/login" id="loginForm">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            
            <!-- Email Field -->
            <div class="mb-4">
              <label class="form-label fw-semibold">
                <i class="fas fa-envelope text-primary me-2"></i>Email Address
              </label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0">
                  <i class="fas fa-envelope text-muted"></i>
                </span>
                <input class="form-control border-start-0 ps-0" type="email" name="email" id="email" required 
                       placeholder="Enter your email address" autocomplete="email">
              </div>
              <div class="invalid-feedback" id="emailFeedback"></div>
            </div>

            <!-- Password Field -->
            <div class="mb-4">
              <label class="form-label fw-semibold">
                <i class="fas fa-lock text-primary me-2"></i>Password
              </label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0">
                  <i class="fas fa-lock text-muted"></i>
                </span>
                <input class="form-control border-start-0 border-end-0 ps-0" type="password" name="password" id="password" required 
                       placeholder="Enter your password" autocomplete="current-password">
                <button class="btn btn-outline-secondary border-start-0" type="button" id="togglePassword">
                  <i class="fas fa-eye" id="toggleIcon"></i>
                </button>
              </div>
              <div class="invalid-feedback" id="passwordFeedback"></div>
            </div>

            <!-- Remember Me & Forgot Password -->
            <div class="row mb-4">
              <div class="col-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="rememberMe" name="rememberMe">
                  <label class="form-check-label text-muted" for="rememberMe">
                    <small>Remember me</small>
                  </label>
                </div>
              </div>
              <div class="col-6 text-end">
                <a href="/auth/forgot" class="text-primary text-decoration-none">
                  <small><i class="fas fa-key me-1"></i>Forgot password?</small>
                </a>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2 mb-4">
              <button class="btn btn-primary btn-lg py-3" type="submit" id="submitBtn">
                <span class="spinner-border spinner-border-sm me-2 d-none" id="submitSpinner" role="status"></span>
                <i class="fas fa-sign-in-alt me-2" id="submitIcon"></i>
                <span id="submitText">Sign In</span>
              </button>
            </div>

            <!-- Divider -->
            <div class="text-center mb-4">
              <div class="d-flex align-items-center">
                <hr class="flex-grow-1">
                <span class="px-3 text-muted small">OR</span>
                <hr class="flex-grow-1">
              </div>
            </div>

            <!-- Register Link -->
            <div class="text-center">
              <div class="card bg-light border-0 p-3">
                <p class="text-muted mb-2">
                  <i class="fas fa-user-plus text-primary me-2"></i>
                  New to SkillSwap MY?
                </p>
                <a href="/auth/register" class="btn btn-outline-primary">
                  <i class="fas fa-user-plus me-2"></i>
                  Create Account
                </a>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Additional Help -->
      <div class="text-center mt-4">
        <div class="card border-0 bg-transparent">
          <div class="card-body py-3">
            <h6 class="text-muted mb-3">
              <i class="fas fa-question-circle me-2"></i>
              Need Help?
            </h6>
            <div class="row">
              <div class="col-4">
                <a href="/about" class="text-decoration-none text-muted">
                  <i class="fas fa-info-circle d-block mb-1"></i>
                  <small>About</small>
                </a>
              </div>
              <div class="col-4">
                <a href="#" class="text-decoration-none text-muted">
                  <i class="fas fa-headset d-block mb-1"></i>
                  <small>Support</small>
                </a>
              </div>
              <div class="col-4">
                <a href="#" class="text-decoration-none text-muted">
                  <i class="fas fa-shield-alt d-block mb-1"></i>
                  <small>Privacy</small>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const submitBtn = document.getElementById('submitBtn');
  const submitSpinner = document.getElementById('submitSpinner');
  const submitIcon = document.getElementById('submitIcon');
  const submitText = document.getElementById('submitText');
  const togglePassword = document.getElementById('togglePassword');
  const toggleIcon = document.getElementById('toggleIcon');
  const loginForm = document.getElementById('loginForm');

  // Password visibility toggle
  togglePassword.addEventListener('click', function() {
    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordInput.setAttribute('type', type);
    
    if (type === 'text') {
      toggleIcon.className = 'fas fa-eye-slash';
    } else {
      toggleIcon.className = 'fas fa-eye';
    }
  });

  // Add input animations and validation
  const inputs = document.querySelectorAll('.form-control');
  inputs.forEach(input => {
    input.addEventListener('focus', function() {
      this.parentElement.classList.add('shadow-sm');
      this.style.transform = 'scale(1.02)';
      this.style.transition = 'transform 0.2s ease-in-out';
      this.classList.remove('is-invalid');
    });
    
    input.addEventListener('blur', function() {
      this.parentElement.classList.remove('shadow-sm');
      this.style.transform = 'scale(1)';
      validateInput(this);
    });

    input.addEventListener('input', function() {
      this.classList.remove('is-invalid');
      updateSubmitButton();
    });
  });

  function validateInput(input) {
    const value = input.value.trim();
    let isValid = true;
    
    if (input.type === 'email') {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      isValid = emailRegex.test(value);
      
      if (!isValid && value.length > 0) {
        input.classList.add('is-invalid');
        document.getElementById('emailFeedback').textContent = 'Please enter a valid email address';
      }
    } else if (input.type === 'password') {
      isValid = value.length >= 1;
      
      if (!isValid && value.length > 0) {
        input.classList.add('is-invalid');
        document.getElementById('passwordFeedback').textContent = 'Password is required';
      }
    }
    
    return isValid;
  }

  function updateSubmitButton() {
    const emailValid = emailInput.value.trim().length > 0 && !emailInput.classList.contains('is-invalid');
    const passwordValid = passwordInput.value.trim().length > 0;
    
    if (emailValid && passwordValid) {
      submitBtn.disabled = false;
      submitBtn.className = 'btn btn-primary btn-lg py-3';
    } else {
      submitBtn.disabled = true;
      submitBtn.className = 'btn btn-outline-secondary btn-lg py-3';
    }
  }

  // Form submission with loading animation
  loginForm.addEventListener('submit', function(e) {
    const emailValid = validateInput(emailInput);
    const passwordValid = validateInput(passwordInput);
    
    if (!emailValid || !passwordValid) {
      e.preventDefault();
      
      // Shake animation for invalid inputs
      const invalidInputs = document.querySelectorAll('.is-invalid');
      invalidInputs.forEach(input => {
        input.style.animation = 'shake 0.5s ease-in-out';
        setTimeout(() => {
          input.style.animation = '';
        }, 500);
      });
      
      return false;
    }

    // Show loading state
    submitBtn.disabled = true;
    submitSpinner.classList.remove('d-none');
    submitIcon.classList.add('d-none');
    submitText.textContent = 'Signing In...';
  });

  // Initial validation
  updateSubmitButton();
});
</script>

<style>
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.form-control:focus {
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
  border-color: #86b7fe;
}

.input-group:focus-within {
  transform: translateY(-1px);
  transition: transform 0.2s ease-in-out;
}

.card {
  transition: transform 0.3s ease-in-out;
}

.card:hover {
  transform: translateY(-2px);
}

.btn {
  transition: all 0.3s ease-in-out;
}

.btn:hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.form-check-input:checked {
  background-color: #0d6efd;
  border-color: #0d6efd;
}

.text-decoration-none:hover {
  text-decoration: underline !important;
}
</style>

<%- include('../partials/footer') %>
