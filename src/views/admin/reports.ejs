<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0 text-gray-800">Manage Reports</h1>
</div>

<div class="card shadow-sm border-0">
  <div class="card-body p-0">
    <% if (!reports || reports.length===0) { %>
      <div class="p-4 text-center text-muted">
        <i class="fas fa-flag fa-3x mb-3 text-secondary"></i>
        <p class="mb-0">No reports found.</p>
      </div>
      <% } else { %>
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="ps-4">ID</th>
                <th>Reporter</th>
                <th>Target</th>
                <th>Reason</th>
                <th>Context</th>
                <th>Status</th>
                <th>Created</th>
                <th class="text-end pe-4">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% reports.forEach(r=> { %>
                <tr>
                  <td class="ps-4"><a href="/reports/<%= r.id %>/review" class="text-decoration-none fw-bold">#<%= r.id
                        %></a>
                  </td>
                  <td>
                    <%= r.reporter?.name || '-' %>
                  </td>
                  <td>
                    <%= r.targetUser?.name || '-' %>
                  </td>
                  <td>
                    <span class="d-inline-block text-truncate" style="max-width: 250px;">
                      <%= r.reason %>
                    </span>
                  </td>
                  <td class="small text-muted">
                    <% if (r.listingId) { %>Listing #<%= r.listingId %><br>
                        <% } %>
                          <% if (r.sessionId) { %>Session #<%= r.sessionId %><br>
                              <% } %>
                                <% if (r.messageThreadId) { %>Thread #<%= r.messageThreadId %>
                                    <% } %>
                                      <% if (!r.listingId && !r.sessionId && !r.messageThreadId) { %>-<% } %>
                  </td>
                  <td>
                    <span class="badge rounded-pill <%= r.status === 'open' ? 'bg-danger' : 'bg-success' %>">
                      <%= r.status.toUpperCase() %>
                    </span>
                  </td>
                  <td>
                    <%= new Date(r.createdAt).toLocaleDateString() %>
                  </td>
                  <td class="text-end pe-4">
                    <% if (r.status==='open' ) { %>
                      <form method="POST" action="/admin/reports/<%= r.id %>/close" class="d-inline">
                        <a href="/reports/<%= r.id %>/review" class="btn btn-sm btn-outline-primary me-1">View</a>
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <button class="btn btn-sm btn-outline-success">Mark Resolved</button>
                      </form>
                      <% } else { %>
                        <a href="/reports/<%= r.id %>/review" class="btn btn-sm btn-outline-primary me-1">View</a>
                        <span class="text-muted small">Resolved</span>
                        <% } %>
                  </td>
                </tr>
                <% }) %>
            </tbody>
          </table>
        </div>
        <div class="p-3 border-top">
          <%- include('../partials/pagination') %>
        </div>
        <% } %>
  </div>
</div>