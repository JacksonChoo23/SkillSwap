<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0 text-gray-800">Manage Listings</h1>
</div>

<!-- Search and Filter -->
<div class="card shadow-sm border-0 mb-4">
  <div class="card-body">
    <form method="GET" action="/admin/listings" class="row g-3 align-items-end">
      <div class="col-md-5">
        <label class="form-label small text-muted">Search</label>
        <input type="text" name="search" class="form-control" placeholder="Search by title or owner..."
          value="<%= search || '' %>">
      </div>
      <div class="col-md-3">
        <label class="form-label small text-muted">Status</label>
        <select name="status" class="form-select">
          <option value="">All Statuses</option>
          <option value="active" <%=status==='active' ? 'selected' : '' %>>Active</option>
          <option value="paused" <%=status==='paused' ? 'selected' : '' %>>Paused</option>
          <option value="closed" <%=status==='closed' ? 'selected' : '' %>>Closed</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">
          <i class="fas fa-search me-1"></i> Filter
        </button>
      </div>
      <div class="col-md-2">
        <a href="/admin/listings" class="btn btn-outline-secondary w-100">
          <i class="fas fa-times me-1"></i> Clear
        </a>
      </div>
    </form>
  </div>
</div>

<div class="card shadow-sm border-0">
  <div class="card-body p-0">
    <% if (!listings || listings.length===0) { %>
      <div class="p-4 text-center text-muted">
        <i class="fas fa-list fa-3x mb-3 text-secondary"></i>
        <p class="mb-0">No listings found in the system.</p>
      </div>
      <% } else { %>
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="ps-4">Title</th>
                <th>Owner</th>
                <th>Status</th>
                <th>Created</th>
                <th class="text-end pe-4">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% listings.forEach(l=> { %>
                <tr>
                  <td class="ps-4">
                    <a href="/listings/<%= l.id %>" class="fw-bold text-decoration-none text-dark">
                      <%= l.title %>
                    </a>
                  </td>
                  <td>
                    <%= l.User?.name || '-' %>
                  </td>
                  <td>
                    <% if (l.status==='active' ) { %>
                      <span class="badge rounded-pill bg-success">Active</span>
                      <% } else if (l.status==='paused' ) { %>
                        <span class="badge rounded-pill bg-warning text-dark">Paused</span>
                        <% } else { %>
                          <span class="badge rounded-pill bg-secondary">
                            <%= l.status %>
                          </span>
                          <% } %>
                  </td>
                  <td>
                    <%= new Date(l.createdAt).toLocaleDateString() %>
                  </td>
                  <td class="text-end pe-4">
                    <div class="d-flex justify-content-end gap-2">
                      <form method="POST" action="/admin/listings/<%= l.id %>/activate">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <input type="hidden" name="returnTo" value="<%= currentUrl || '' %>">
                        <button class="btn btn-sm btn-outline-success" <%=l.status==='active' ? 'disabled' : '' %>>
                          Activate
                        </button>
                      </form>
                      <form method="POST" action="/admin/listings/<%= l.id %>/close">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <input type="hidden" name="returnTo" value="<%= currentUrl || '' %>">
                        <button class="btn btn-sm btn-outline-danger" <%=l.status==='closed' ? 'disabled' : '' %>>
                          Close
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
                <% }) %>
            </tbody>
          </table>
        </div>
        <div class="p-3 border-top">
          <%- include('../partials/pagination') %>
        </div>
        <% } %>
  </div>
</div>