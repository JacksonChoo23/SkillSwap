<% const l = listing; %>
<h1 class="h4 mb-3">Edit Listing</h1>

<form method="POST" action="/listings/<%= l.id %>/edit" class="row g-3">
  <input type="hidden" name="_csrf" value="<%= csrfToken %>">

  <div class="col-12">
    <label class="form-label">Title</label>
    <input class="form-control" name="title" required maxlength="255" value="<%= l.title %>">
  </div>

  <div class="col-12">
    <label class="form-label">Description</label>
    <textarea class="form-control" name="description" rows="6" required><%= l.description %></textarea>
  </div>

  <div class="col-md-6">
    <label class="form-label">Teaching Skill (from your profile)</label>
    <select class="form-select" name="skill_id" required>
      <% (Array.isArray(teachSkills) ? teachSkills : []).forEach(s => { %>
        <option value="<%= s.id %>" <%= s.id === l.skillId ? 'selected' : '' %>><%= s.name %></option>
      <% }) %>
    </select>
    <small class="form-text text-muted">Only skills you marked as "teach" in your profile are shown.</small>
  </div>

  <div class="col-md-6">
    <label class="form-label">Wants To Learn (optional)</label>
    <select class="form-select" name="learn_skill_id" required>
      <option value="">Select a skill you want to learn</option>
      <% (Array.isArray(learnSkills) ? learnSkills : []).forEach(s => { %>
        <option value="<%= s.id %>" <%= s.id === l.learnSkillId ? 'selected' : '' %>><%= s.name %></option>
      <% }) %>
    </select>
    <small class="form-text text-muted">Only skills you marked as "learn" in your profile are shown.</small>
  </div>

  <div class="col-md-6">
    <label class="form-label">Visibility</label>
    <select class="form-select" name="visibility">
      <option value="public"  <%= l.visibility === 'public'  ? 'selected' : '' %> >Public</option>
      <option value="private" <%= l.visibility === 'private' ? 'selected' : '' %> >Private</option>
    </select>
  </div>

  <div class="col-12 d-flex gap-2">
    <button class="btn btn-primary" type="submit">Save</button>
    <a class="btn btn-outline-secondary" href="/listings/<%= l.id %>">Cancel</a>
  </div>
</form>
