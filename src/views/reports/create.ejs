<!-- src/views/reports/create.ejs -->
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-danger text-white py-3">
                    <h4 class="mb-0"><i class="bi bi-flag me-2"></i>Report User</h4>
                </div>
                <div class="card-body p-4">

                    <!-- AI Review Notice -->
                    <div class="alert alert-info d-flex align-items-start mb-4">
                        <i class="bi bi-robot fs-4 me-3"></i>
                        <div>
                            <strong>AI-Powered Review</strong>
                            <p class="mb-0 small">Your report will be analyzed by our AI moderation system for faster
                                processing. You'll receive results within seconds. If you disagree with the AI's
                                assessment, you can escalate to human review.</p>
                        </div>
                    </div>

                    <!-- Review Time Comparison -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card bg-success bg-opacity-10 border-success">
                                <div class="card-body text-center py-3">
                                    <i class="bi bi-lightning-charge text-success fs-3"></i>
                                    <h6 class="mt-2 mb-1">AI Review</h6>
                                    <span class="badge bg-success">
                                        < 1 minute</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-secondary bg-opacity-10 border-secondary">
                                <div class="card-body text-center py-3">
                                    <i class="bi bi-person-gear text-secondary fs-3"></i>
                                    <h6 class="mt-2 mb-1">Manual Review</h6>
                                    <span class="badge bg-secondary">24-48 hours</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form action="/reports?_csrf=<%= csrfToken %>" method="POST" enctype="multipart/form-data">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">

                        <!-- Target User -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Reporting User</label>
                            <% if (targetUser) { %>
                                <input type="hidden" name="targetUserId" value="<%= targetUser.id %>">
                                <div class="d-flex align-items-center p-3 bg-light rounded">
                                    <img src="<%= targetUser.profileImage || '/images/default-avatar.png' %>"
                                        alt="<%= targetUser.name %>" class="rounded-circle me-3"
                                        style="width: 50px; height: 50px; object-fit: cover;">
                                    <div>
                                        <h6 class="mb-0">
                                            <%= targetUser.name %>
                                        </h6>
                                        <small class="text-muted">User ID: <%= targetUser.id %></small>
                                    </div>
                                </div>
                                <% } else { %>
                                    <input type="number" name="targetUserId" class="form-control"
                                        placeholder="Enter User ID" required>
                                    <small class="text-muted">Enter the ID of the user you want to report.</small>
                                    <% } %>
                        </div>

                        <!-- Reason -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Reason for Report <span
                                    class="text-danger">*</span></label>
                            <textarea name="reason" class="form-control" rows="5"
                                placeholder="Please describe the issue in detail. Include specific examples, dates, and any context that would help us understand the situation..."
                                minlength="10" maxlength="2000" required></textarea>
                            <small class="text-muted">Minimum 10 characters. Be specific and factual.</small>
                        </div>

                        <!-- Evidence Upload -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Evidence (Optional)</label>
                            <div class="border rounded p-4 text-center bg-light" id="dropzone">
                                <i class="bi bi-cloud-upload fs-1 text-muted"></i>
                                <p class="mb-2">Upload screenshots or images as evidence</p>
                                <input type="file" name="evidence" id="evidenceInput" class="form-control" multiple
                                    accept="image/jpeg,image/png,image/gif,image/webp">
                                <small class="text-muted d-block mt-2">Max 5 files, 5MB each. JPEG, PNG, GIF, WebP
                                    only.</small>
                            </div>
                            <div id="preview" class="row mt-3"></div>
                        </div>

                        <!-- Submit -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-danger btn-lg">
                                <i class="bi bi-send me-2"></i>Submit for AI Review
                            </button>
                            <a href="javascript:history.back()" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Policy Reminder -->
            <div class="card mt-4 border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="fw-semibold"><i class="bi bi-info-circle me-2 text-primary"></i>What happens after you
                        submit?</h6>
                    <ol class="mb-0 small text-muted">
                        <li>Your report is immediately analyzed by our AI moderation system</li>
                        <li>You'll see the AI's assessment and recommended action</li>
                        <li>If you agree, the action is applied automatically</li>
                        <li>If you disagree, you can escalate to our human moderation team</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // File preview functionality
    document.getElementById('evidenceInput').addEventListener('change', function (e) {
        const preview = document.getElementById('preview');
        preview.innerHTML = '';

        Array.from(this.files).slice(0, 5).forEach((file, idx) => {
            if (file.size > 5 * 1024 * 1024) {
                alert(`File "${file.name}" is too large. Max 5MB.`);
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const col = document.createElement('div');
                col.className = 'col-4 col-md-3 mb-2';
                col.innerHTML = `
          <div class="position-relative">
            <img src="${e.target.result}" class="img-thumbnail" style="width:100%;height:80px;object-fit:cover;">
            <small class="d-block text-truncate">${file.name}</small>
          </div>
        `;
                preview.appendChild(col);
            };
            reader.readAsDataURL(file);
        });
    });
</script>